'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getJson = getJson;
exports.mapConfToResults = mapConfToResults;

var _fetchError = require('./errors/fetch-error');

var _fetchError2 = _interopRequireDefault(_fetchError);

var _nodeFetch = require('node-fetch');

var _nodeFetch2 = _interopRequireDefault(_nodeFetch);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function getJson(item, itemIndex) {

  return new Promise(function (resolve, reject) {
    (0, _nodeFetch2.default)(item.endpoint).then(function (res) {
      resolve(res.json());
    }).catch(function (e) {
      reject(new _fetchError2.default('there was an error requesting the endpoint', { itemIndex: itemIndex }));
    });
  });
}

function mapConfToResults(conf) {

  var loadedItems = conf.map(function (item, itemIndex) {
    return getJson(item, itemIndex).then(function (json) {
      item._result = json;
      return item;
    });
  });

  return Promise.all(loadedItems);
}